{% extends 'base/base.html' %}
{% load static %}
{% load filters %}
{% block title %}Спорт-площадки{% endblock %}

{% block content %}
<div class="container">
    <div class="category-section">
        <h2 class="section-title">Выбрать категорию</h2>
        <div class="card-list category-list">
            {% for category in popular_categories %}
            <div class="category-card">
    <a href="{% url 'category_detail' category.slug %}">
        {% if category.cover_photo %}
            <img src="{{ category.cover_photo.url }}" alt="{{ category.name }}" class="card-image category-image">
        {% else %}
            <div class="placeholder-image">
                <p>Нет фото</p>
            </div>
        {% endif %}
        <div class="category-overlay">
            <h3 class="category-title">{{ category.name }}</h3>
            <p class="category-count">{{ category.places.count }} площадок</p>
        </div>
    </a>
</div>
            {% endfor %}
        </div>
        <div class="card-list category-list" id="other-categories" style="display: none;">
            {% for category in other_categories %}
            <div class="category-card">
                <a href="{% url 'category_detail' category.slug %}">
                    {% if category.cover_photo %}
                        <img src="{{ category.cover_photo.url }}" alt="{{ category.name }}" class="card-image category-image">
                    {% else %}
                        <div class="placeholder-image">
                            <p>Нет фото</p>
                        </div>
                    {% endif %}
                    <div class="category-overlay">
                        <h3 class="category-title">{{ category.name }}</h3>
                        <p class="category-count">{{ category.places.count|pluralize_places }}</p>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
        {% if other_categories %}
            <div class="show-all-btn-container">
                <button id="show-all-btn">Показать все</button>
            </div>
        {% endif %}
    </div>

    <hr>

    <div class="place-section">
        <h2 class="section-title">Популярные площадки</h2>
        
        <div class="pagination-container">
            <div class="card-list popular-places-page active-page">
                {% for place in popular_places %}
                <div class="card">
                    <a href="{% url 'place_detail' place.id %}">
                        {% if place.first_photo %}
                            <img src="{{ place.first_photo.image.url }}" alt="{{ place.name }}" class="card-image">
                        {% else %}
                            <div class="placeholder-image">
                                <p>Нет фото</p>
                            </div>
                        {% endif %}
                        <div class="card-content">
                            <h3 class="card-title">{{ place.name }}</h3>
                            {% if place.average_rating %}
                                <div class="rating-display">
                                    {% for _ in "12345"|make_list %}
                                        <span class="star {% if forloop.counter <= place.average_rating %}filled{% endif %}">&#9733;</span>
                                    {% endfor %}
                                    <span class="rating-value">{{ place.average_rating|floatformat:1 }}</span>
                                </div>
                            {% else %}
                                <p class="no-rating">Нет рейтинга</p>
                            {% endif %}
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    
        <div class="pagination-dots">
            {% if popular_places|length > 4 %}
                <span class="dot active-dot" data-page="0"></span>
                <span class="dot" data-page="1"></span>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- Ваш существующий код для кнопки "Показать все категории" ---
    const showAllBtn = document.getElementById('show-all-btn');
    const otherCategories = document.getElementById('other-categories');

    if (showAllBtn) {
        showAllBtn.addEventListener('click', function() {
            if (otherCategories.style.display === 'none') {
                otherCategories.style.display = 'grid';
                showAllBtn.textContent = 'Скрыть';
            } else {
                otherCategories.style.display = 'none';
                showAllBtn.textContent = 'Показать все';
            }
        });
    }

    // --- НОВЫЙ КОД ДЛЯ ПАГИНАЦИИ ---
    const dots = document.querySelectorAll('.pagination-dots .dot');
    const page = document.querySelector('.popular-places-page');
    const cards = page.querySelectorAll('.card');
    
    // Скрываем все карточки, кроме первых 4
    cards.forEach((card, index) => {
        if (index >= 4) {
            card.style.display = 'none';
        }
    });

    dots.forEach(dot => {
        dot.addEventListener('click', function() {
            // Удаляем класс 'active-dot' со всех точек
            dots.forEach(d => d.classList.remove('active-dot'));
            // Добавляем класс 'active-dot' только на нажатую точку
            this.classList.add('active-dot');

            const pageIndex = this.getAttribute('data-page');

            if (pageIndex === '0') {
                // Показываем первые 4 карточки
                cards.forEach((card, index) => {
                    if (index < 4) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            } else if (pageIndex === '1') {
                // Показываем вторые 4 карточки
                cards.forEach((card, index) => {
                    if (index >= 4) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }
        });
    });
});
</script>
{% endblock %}