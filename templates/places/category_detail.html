{% extends 'base/base.html' %}
{% load static %}
{% load filters %}

{% block title %}{{ current_category.name }}{% endblock %}

{% block content %}
<div class="container">
    <div class="category-page-wrapper">
        <div class="category-list-container">
            <div class="category-header">
                <h1 class="current-category-title">{{ current_category.name }}</h1>
                <div class="category-dropdown-wrapper">
                    <select id="category-select" onchange="window.location.href = this.value;">
                        <option value="#" disabled {% if not category.name %}selected{% endif %}>Изменить категорию</option>
                        {% for cat in all_categories %}
                            <option value="{% url 'category_detail' cat.slug %}" {% if cat.slug == category.slug %}selected{% endif %}>
                                {{ cat.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <p class="category-count">{{ current_category.places.count|pluralize_places }}</p>
            <div class="place-list-scrollable">
                <div class="card-list place-list-category">
                {% if places %}
                    {% for place in places %}
                        <div class="card">
                            <a href="{% url 'place_detail' place.id %}">
                                {% if place.first_photo %}
                                    <img src="{{ place.first_photo.image.url }}" alt="{{ place.name }}" class="card-image">
                                {% else %}
                                    <div class="placeholder-image">
                                        <p>Нет фото</p>
                                    </div>
                                {% endif %}
                                <div class="card-content">
                                    <h3 class="card-title">{{ place.name }}</h3>
                                    <div class="rating-display">
                                        {% if place.average_rating %}
                                            {% for _ in "12345"|make_list %}
                                                <span class="star {% if forloop.counter <= place.average_rating %}filled{% endif %}">&#9733;</span>
                                            {% endfor %}
                                            <span class="rating-value">{{ place.average_rating|floatformat:1 }}</span>
                                        {% else %}
                                            <span class="no-rating">Нет рейтинга</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </a>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>В этой категории пока нет площадок.</p>
                {% endif %}
                </div>
            </div>
        </div>
        <div class="map-container fixed-map">
            {% if place_map %}
                {{ place_map|safe }}
            {% else %}
                <p>Нет маркеров для отображения.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}